# Flyweight
同じものを共有して無駄をなくす

## どんなものか
メモリの使用量を減らすために「インスタンスをできるだけ共有させて、無駄にnewしない」

## 登場人物
### Flyweight
メモリを逼迫する可能性があるため、共有した方がよいもの
> サンプルプログラムのBigCharクラス

### FlyweightFactory
Flyweightを作る工場。FlyweightFactoryを使ってFlyweightを作るとインスタンスが共有される
> サンプルプログラムのBigCharFactoryクラス

### Client
FlyweightFactory経由でFlyweightを作り、それを利用する
> サンプルプログラムのBigStringクラス

## メリットとデメリット
#### 影響範囲
Flyweightパターンを使うとインスタンスを共有している分、メモリ使用量は抑えることができる。
一方、大元のインスタンスを変更すると変更が複数箇所に影響が及ぶという問題も。

#### 共有させる情報と共有させない情報
インスタンスのもととなるクラスが様々なプロパティ(もしくはフィールド)を持っている場合、共有するプロパティの線引きが必要になる。
共有させたくない情報は、予めデフォルト値や`nil`を設定したり、別のクラスに切り出したりするなどの対応をすることになるだろう。

#### メモリ解放機構との相性
Javaならガーベジコレクション、SwiftならARCが、参照されなくなったメモリの面倒を見てくれる。
しかし、Shared Instanceが一度`Client`によって`FlyweightFactory`経由で生成されたら、明示的に解放してあげない限り生き残り続けることになるということを、エンジニアは把握しておく必要がある。


#### メモリ消費は抑えられるけれども
Flyweightパターンは銀の弾丸ではない。メモリを消費を抑えられる一方でディスクリソースやネットワークリソースを食うことは忘れてはいけない。
Flyweightのメリットはあくまでインスタンス**生成**時のメモリリソースを抑えることができるということ。
トレードオフになっている関係を把握し、Flyweightの使い所を見極めて導入するかどうか検討する必要がある。
